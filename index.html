<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dulce Pesadilla Navideña</title>
    <style>
        /* --- ESTILOS GENERALES (Reset) --- */
        * { box-sizing: border-box; } /* Esto evita que los bordes rompan el diseño */
        
        body { margin: 0; padding: 0; background-color: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #game-container { width: 100%; max-width: 450px; height: 100%; position: relative; background-color: #000; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* --- SISTEMA DE IMAGEN (Una sola capa + Fusión) --- */
        .scene-layer { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
            background-size: cover; background-position: center; background-repeat: no-repeat;
            z-index: 1;
        }
        #scene-layer-back { z-index: 1; }
        #scene-layer-front { z-index: 2; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .fade-in { opacity: 1 !important; }

        /* --- INTERFAZ (UI) --- */
        #ui-layer { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; 
            z-index: 10; display: flex; flex-direction: column; justify-content: flex-end; 
            padding: 20px; pointer-events: none; 
        }
        
        .interactive { pointer-events: auto; }

        /* CAJA DE TEXTO (Reforzada) */
        .text-box { 
            background: rgba(0, 0, 0, 0.85); 
            width: 100%; /* Ocupa todo el ancho disponible */
            padding: 20px; 
            border-radius: 12px; 
            border: 1px solid #555; 
            min-height: 130px; 
            display: flex; 
            flex-direction: column; 
            position: relative; 
            margin-bottom: 0;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
        }

        .name-tag { font-weight: bold; color: #ff4d4d; margin-bottom: 10px; text-transform: uppercase; font-size: 0.95em; letter-spacing: 1px; }
        .dialogue { font-size: 1.1em; line-height: 1.5; color: #eee; margin-bottom: 20px; }
        
        /* FLECHA */
        .next-arrow { 
            position: absolute; bottom: 10px; right: 15px; 
            color: #aaa; font-size: 1.5em; cursor: pointer; 
            animation: bounce 1s infinite; 
        }

        /* OPCIONES */
        .choices-container { display: flex; flex-direction: column; gap: 10px; width: 100%; margin-bottom: 15px; }
        .btn { 
            padding: 15px; border-radius: 8px; border: none; cursor: pointer; 
            font-size: 1em; font-weight: bold; text-align: center; width: 100%;
        }
        .btn-normal { background: #333; color: white; border: 1px solid #555; }
        .btn-premium { background: linear-gradient(135deg, #b8860b, #ffd700); color: #2b1d00; border: 1px solid #ffcc00; font-weight: 800; }
        
        .hidden { display: none !important; }
        
        /* EFECTOS */
        .shake { animation: shake 0.5s; }
        .red-flash { position: absolute; top:0; left:0; width:100%; height:100%; background: red; opacity: 0; pointer-events: none; z-index: 20; transition: opacity 0.2s; }
        .flash-active { opacity: 0.5 !important; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -2px); } 100% { transform: translate(1px, -1px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="scene-layer-back" class="scene-layer"></div>
    <div id="scene-layer-front" class="scene-layer"></div>
    <div id="flash-overlay" class="red-flash"></div>

    <div id="ui-layer">
        <div id="choices-area" class="choices-container interactive hidden"></div>
        
        <div id="text-area" class="text-box interactive">
            <div id="char-name" class="name-tag">Nombre</div>
            <div id="dialogue-text" class="dialogue">...</div>
            <div id="next-btn" class="next-arrow">▼</div>
        </div>
    </div>
</div>

<script>
    /* === TUS IMÁGENES EXACTAS (De GitHub) === */
    const SALA_LUZ = 'sala_luz.jpg';
    const SALA_NO_LUZ = 'sala_no_luz.jpg';
    const CUARTO_NOCHE = 'cuarto_noche.jpg';
    const PUERTA_SALIR = 'puerta_salir.jpg';
    const PANTALLA_MUERTE = 'pantalla_muerte.jpg';
    
    const JOHN_SALA = 'santa_sala.jpg';
    const JOHN_ASESINO = 'santa_cara_asesino.jpg';
    const JOHN_RIE = 'santa_rie.jpg';
    const JOHN_CUARTO = 'santa_cuarto.jpg';
    const JOHN_CERCA = 'santa_cerca.jpg';
    const JOHN_DESVISTE = 'santa_desviste.jpg';
    
    // CGs (Escenas especiales)
    const CG_CAMA = 'santa_cama_abajo.jpg';
    const CG_BESO_MANO = 'beso_mano.jpg';
    const CG_BESO_PIERNA = 'beso_pierna.jpg';
    const CG_LEVANTA = 'levanta_pierna.jpg';
    const CG_NOTA = 'mensaje_final.jpg';
    const CG_REVUELTO = 'cuarto_revuelto.jpg';

    const BG_NEGRO = '#000';

    /* === HISTORIA === */
    const story = {
        // --- ESCENA 1: INTRO ---
        "start": {
            img: BG_NEGRO, // Empieza en negro (Correcto)
            text: "\"Dicen que la Navidad es la época más mágica del año... Risas, familia, regalos bajo el árbol.\"",
            name: "Tú",
            next: "intro_2"
        },
        "intro_2": {
            img: BG_NEGRO,
            text: "\"Pero para mí... es solo otra noche de silencio ensordecedor.\"",
            name: "Tú",
            next: "sala_llegada"
        },
        "sala_llegada": {
            img: SALA_LUZ, // Aquí aparece la sala
            text: "\"Llegué del trabajo arrastrando los pies. El frío se me ha metido hasta los huesos.\"",
            name: "Tú",
            next: "sala_pensamiento"
        },
        "sala_pensamiento": {
            img: SALA_LUZ,
            text: "\"Mira este lugar... Lleno de luces y adornos. ¿Para qué me molesté en decorar si vivo sola?\"",
            name: "Tú",
            next: "sala_infancia"
        },
        "sala_infancia": {
            img: SALA_LUZ,
            text: "Haa... Es irónico... De pequeña, solía esconderme detrás de este mismo sofá.",
            name: "Tú",
            next: "sala_santa_fake"
        },
        "sala_santa_fake": {
            img: SALA_LUZ,
            text: "Aguantaba la respiración, esperando ver a Santa Claus bajar por la chimenea. Nunca lo vi.",
            name: "Tú",
            next: "sala_realidad"
        },
        "sala_realidad": {
            img: SALA_LUZ,
            text: "Cosas de niños ingenuos. Los milagros no bajan por la chimenea. En la vida real, si alguien entra a medianoche...",
            name: "Tú",
            next: "sala_peligro"
        },
        "sala_peligro": {
            img: SALA_LUZ,
            text: "...probablemente no venga a dejar regalos.",
            name: "Tú",
            effect: "flash",
            next: "sala_apagar"
        },
        "sala_apagar": {
            img: SALA_LUZ,
            text: "Basta de melancolía. Mañana será otro día. Apagaré todo y me iré a la cama.",
            name: "Tú",
            next: "sala_oscura"
        },
        "sala_oscura": {
            img: SALA_NO_LUZ,
            text: "Solo quiero dormir y olvidar que es Navidad.",
            name: "Tú",
            next: "cuarto_ruido"
        },
        
        // --- EL RUIDO ---
        "cuarto_ruido": {
            img: CUARTO_NOCHE,
            sound: "shake",
            text: "CRASH. ¿Qué...? ¿Qué fue eso? \"Juraría que cerré la puerta con llave.\"",
            name: "Tú",
            choices: [
                { text: "Tengo miedo (Esconderme)", target: "ruta_miedo", type: "normal" },
                { text: "Investigar (Ir a la sala)", target: "ruta_investigar", type: "premium" }
            ]
        },

        // --- RUTA A: MIEDO (MUERTE) ---
        "ruta_miedo": {
            img: BG_NEGRO,
            text: "\"No... no quiero ver. Si no me muevo, quizás se vaya.\"",
            name: "Tú",
            next: "miedo_2"
        },
        "miedo_2": {
            img: BG_NEGRO,
            text: "\"Cierro los ojos con fuerza. Escucho pasos pesados... Se detienen justo a mi lado.\"",
            name: "Tú",
            next: "miedo_voz"
        },
        "miedo_voz": {
            img: BG_NEGRO,
            sound: "shake",
            text: "Te encontré...",
            name: "Voz Desconocida",
            next: "muerte_1"
        },
        "muerte_1": {
            img: PANTALLA_MUERTE,
            text: "\"Ni siquiera me dio tiempo a gritar... Sentí un estallido de dolor... y luego nada.\"",
            name: "Tú",
            next: "fin_malo_1"
        },
        "fin_malo_1": {
            img: BG_NEGRO,
            text: "[FINAL MALO 1: Muerte entre sábanas]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA B: INVESTIGAR (ENCUENTRO) ---
        "ruta_investigar": {
            img: SALA_NO_LUZ,
            text: "\"Me armé de valor y salí.\"",
            name: "Tú",
            next: "encuentro_john"
        },
        "encuentro_john": {
            img: JOHN_SALA,
            text: "\"Allí estaba él. Un hombre alto... ¿vestido de Santa Claus?\"",
            name: "Tú",
            next: "encuentro_reconocimiento"
        },
        "encuentro_reconocimiento": {
            img: JOHN_SALA,
            text: "\"Esa sonrisa... Esa mirada roja... Es él. 'El Asesino de Nochebuena'. John Red.\"",
            name: "Tú",
            next: "john_habla_1"
        },
        "john_habla_1": {
            img: JOHN_SALA,
            text: "Vaya bienvenida. ¿Es así como tratas a Santa cuando viene a visitarte?",
            name: "John Red",
            choices: [
                { text: "¡Sé quién eres! (Confrontar)", target: "ruta_confrontar", type: "normal" },
                { text: "Seguirle el juego (Seducir)", target: "ruta_seducir", type: "premium" }
            ]
        },

        // --- RUTA CONFRONTAR (MUERTE) ---
        "ruta_confrontar": {
            img: JOHN_SALA,
            text: "¡Déjate de juegos! ¡Sé quién eres! Eres John Red. ¡Aléjate de mí!",
            name: "Tú",
            next: "confrontar_john"
        },
        "confrontar_john": {
            img: JOHN_ASESINO,
            text: "Tsk. Qué aguafiestas. Odio cuando arruinan la inmersión del personaje.",
            name: "John Red",
            next: "huida_puerta"
        },
        "huida_puerta": {
            img: PUERTA_SALIR,
            text: "¡Espera, no-! \"Debo salir rápido...\"",
            name: "Tú",
            next: "muerte_2"
        },
        "muerte_2": {
            img: PANTALLA_MUERTE,
            text: "\"Es inhumano... Se movió más rápido que mi propia sombra. El cuchillo... quema...\"",
            name: "Tú",
            next: "fin_malo_2"
        },
        "fin_malo_2": {
            img: BG_NEGRO,
            text: "[FINAL MALO 2: Enfrentarlo no es una Opción]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA SEDUCIR ---
        "ruta_seducir": {
            img: JOHN_SALA,
            text: "\"Tranquila... Voy a apostarlo todo a una carta: su ego.\"",
            name: "Tú",
            next: "seducir_dialogo"
        },
        "seducir_dialogo": {
            img: JOHN_RIE,
            text: "Vaya... No sabía que Santa Claus sería tan joven... y tan atractivo.",
            name: "Tú",
            next: "john_interes"
        },
        "john_interes": {
            img: JOHN_RIE,
            text: "Jajaja... Interesante. Dime... ¿Has sido una chica mala este año?",
            name: "John Red",
            choices: [
                { text: "He sido una buena chica...", target: "ruta_buena", type: "normal" },
                { text: "Quiero hacer cosas malas...", target: "ruta_mala", type: "premium" }
            ]
        },

        // --- RUTA CHICA BUENA (MUERTE) ---
        "ruta_buena": {
            img: JOHN_RIE,
            text: "He sido una buena chica todo el año. Merezco algo bueno, ¿verdad?",
            name: "Tú",
            next: "john_buena"
        },
        "john_buena": {
            img: JOHN_RIE,
            text: "¿Ah, sí? Mmm... Las chicas buenas merecen recompensas especiales. Cierra los ojos.",
            name: "John Red",
            next: "buena_ojos"
        },
        "buena_ojos": {
            img: BG_NEGRO,
            text: "\"Cierro los ojos, sintiendo un leve alivio...\"",
            name: "Tú",
            next: "muerte_3"
        },
        "muerte_3": {
            img: PANTALLA_MUERTE,
            text: "¡Ah...! ¿Por... qué...?",
            name: "Tú",
            next: "john_regalo_final"
        },
        "john_regalo_final": {
            img: PANTALLA_MUERTE,
            text: "¿Te gusta mi regalo? No hay regalo más hermoso que quitar una vida. Feliz Navidad.",
            name: "John Red",
            next: "fin_malo_3"
        },
        "fin_malo_3": {
            img: BG_NEGRO,
            text: "[FINAL MALO 3: Regalo Equivocado]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA CHICA MALA ---
        "ruta_mala": {
            img: JOHN_RIE,
            text: "He sido buena... pero esta noche quiero hacer cosas malas.",
            name: "Tú",
            next: "john_sorpresa"
        },
        "john_sorpresa": {
            img: JOHN_RIE,
            text: "Jaja... Vaya. Eso no me lo esperaba.",
            name: "John Red",
            next: "mala_tactil"
        },
        "mala_tactil": {
            img: JOHN_SALA,
            text: "\"Pongo una mano sobre su pecho.\" Ya que estás aquí... ¿Puedo pedir al Santa como regalo?",
            name: "Tú",
            next: "john_advertencia"
        },
        "john_advertencia": {
            img: JOHN_SALA,
            text: "Cuidado con lo que deseas... Santa no acepta devoluciones.",
            name: "John Red",
            next: "cuarto_final"
        },
        "cuarto_final": {
            img: JOHN_CUARTO,
            text: "\"Ahora estoy en mi cuarto, y él me mira desde arriba con intensidad.\"",
            name: "Tú",
            next: "cama_cg"
        },
        "cama_cg": {
            img: CG_CAMA,
            text: "\"Me empuja a la cama. Su mirada es depredadora.\"",
            name: "Narración",
            next: "john_olvido"
        },
        "john_olvido": {
            img: CG_CAMA,
            text: "Olvídate de la Navidad. Esta noche solo existimos tú y yo.",
            name: "John Red",
            next: "desvestirse"
        },
        "desvestirse": {
            img: JOHN_DESVISTE,
            text: "'¿No tienes calor?' Se abre el traje. Sus abdominales son perfectos.",
            name: "Tú",
            next: "fin_demo"
        },
        "fin_demo": {
            img: BG_NEGRO,
            text: "FIN DE LA DEMO - CONTINUARÁ...",
            name: "Sistema",
            restart: true
        }
    };

    /* === MOTOR (LÓGICA) === */
    const sceneBack = document.getElementById("scene-layer-back");
    const sceneFront = document.getElementById("scene-layer-front");
    const flashOverlay = document.getElementById("flash-overlay");
    
    const textName = document.getElementById("char-name");
    const textDialog = document.getElementById("dialogue-text");
    const nextBtn = document.getElementById("next-btn");
    const choicesArea = document.getElementById("choices-area");

    function setLayerImage(layer, imgSource) {
        if (imgSource.startsWith("#")) {
            layer.style.backgroundImage = "none";
            layer.style.backgroundColor = imgSource;
        } else {
            layer.style.backgroundColor = "#000";
            layer.style.backgroundImage = `url('${imgSource}')`;
        }
    }

    function renderNode(nodeId) {
        const node = story[nodeId];
        nextBtn.classList.remove("hidden");
        choicesArea.classList.add("hidden");
        choicesArea.innerHTML = "";
        flashOverlay.classList.remove("flash-active");

        // FUSIÓN DE IMAGEN
        if (node.img) {
            setLayerImage(sceneFront, node.img);
            setTimeout(() => { sceneFront.classList.add("fade-in"); }, 50);
            setTimeout(() => {
                setLayerImage(sceneBack, node.img);
                sceneFront.classList.remove("fade-in");
            }, 550);
        }

        // TEXTO
        textName.textContent = node.name || "";
        textDialog.textContent = node.text || "...";

        // EFECTOS
        if (node.sound === "shake") {
            document.body.classList.add("shake");
            setTimeout(() => document.body.classList.remove("shake"), 500);
        }
        if (node.effect === "flash") {
            flashOverlay.classList.add("flash-active");
            setTimeout(() => flashOverlay.classList.remove("flash-active"), 200);
        }

        // OPCIONES
        if (node.choices) {
            nextBtn.classList.add("hidden");
            choicesArea.classList.remove("hidden");
            node.choices.forEach(choice => {
                const btn = document.createElement("button");
                btn.className = choice.type === "premium" ? "btn btn-premium" : "btn btn-normal";
                btn.textContent = choice.text;
                btn.onclick = () => renderNode(choice.target);
                choicesArea.appendChild(btn);
            });
        } else if (node.restart) {
            nextBtn.onclick = () => location.reload();
            nextBtn.textContent = "↻ Reiniciar";
        } else {
            nextBtn.onclick = () => renderNode(node.next);
            nextBtn.textContent = "▼";
        }
    }

    // INICIO
    window.onload = () => { 
        setLayerImage(sceneBack, story["start"].img);
        renderNode("start"); 
    };
</script>
</body>
</html>
