<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dulce Pesadilla NavideÃ±a</title>
    <style>
        /* ESTILOS GENERALES */
        body { margin: 0; padding: 0; background-color: #000; color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #game-container { width: 100%; max-width: 450px; height: 100%; position: relative; background-color: #000; overflow: hidden; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* --- SISTEMA DE FUSIÃ“N (CROSSFADE) --- */
        .scene-layer { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat;
            z-index: 1;
        }

        #scene-layer-back { z-index: 1; }

        #scene-layer-front { 
            z-index: 2;
            opacity: 0; 
            transition: opacity 0.8s ease-in-out; /* Suavidad de la fusiÃ³n */
        }

        .fade-in { opacity: 1 !important; }
        /* ------------------------------------ */
        
        /* EFECTOS Y UI */
        #effect-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 3; transition: background 0.1s; }
        
        #ui-layer { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; z-index: 10; display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 20px; pointer-events: none; }
        
        .interactive { pointer-events: auto; }

        .text-box { background: rgba(0, 0, 0, 0.85); margin: 10px 15px; padding: 15px; border-radius: 10px; border: 1px solid #444; min-height: 120px; display: flex; flex-direction: column; position: relative; }
        .name-tag { font-weight: bold; color: #ff4d4d; margin-bottom: 8px; text-transform: uppercase; font-size: 0.9em; letter-spacing: 1px; }
        .dialogue { font-size: 1.05em; line-height: 1.4; color: #eee; }
        
        .choices-container { display: flex; flex-direction: column; gap: 12px; padding: 0 20px; margin-bottom: 15px; }
        .btn { padding: 14px; border-radius: 8px; border: none; cursor: pointer; font-size: 1em; font-weight: bold; text-align: center; transition: transform 0.1s; }
        .btn:active { transform: scale(0.98); }
        
        .btn-normal { background: #333; color: #fff; border: 1px solid #555; }
        /* Estilo visual premium pero sin candado funcional para la prueba */
        .btn-premium { background: linear-gradient(135deg, #b8860b, #ffd700); color: #2b1d00; border: 1px solid #ffcc00; font-weight: 800; }
        .btn-premium::after { content: "ðŸ’Ž"; margin-left: 8px; }
        
        .next-arrow { position: absolute; bottom: 10px; right: 15px; color: #aaa; font-size: 1.5em; animation: bounce 1s infinite; cursor: pointer; }
        .hidden { display: none !important; }
        
        /* ANIMACIONES */
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        .red-flash { background-color: rgba(200, 0, 0, 0.6) !important; }
        
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-6px, 0, 0); } 40%, 60% { transform: translate3d(6px, 0, 0); } }
    </style>
</head>
<body>

<div id="game-container">
    <div id="scene-layer-back" class="scene-layer"></div>
    <div id="scene-layer-front" class="scene-layer"></div>
    <div id="effect-layer"></div>

    <div id="ui-layer">
        <div id="choices-area" class="choices-container interactive hidden"></div>
        <div id="text-area" class="text-box interactive">
            <div id="char-name" class="name-tag"></div>
            <div id="dialogue-text" class="dialogue"></div>
            <div id="next-btn" class="next-arrow">â–¼</div>
        </div>
    </div>
</div>

<script>
    /* === CONFIGURACIÃ“N DE IMÃGENES === */
    // Escenas
    const SALA_LUZ = 'sala_luz.jpg';
    const SALA_NO_LUZ = 'sala_no_luz.jpg';
    const CUARTO_NOCHE = 'cuarto_noche.jpg';
    const PUERTA_SALIR = 'puerta_salir.jpg';
    const PANTALLA_MUERTE = 'pantalla_muerte.jpg';
    
    // John Red
    const JOHN_SALA = 'santa_sala.jpg';
    const JOHN_ASESINO = 'santa_cara_asesino.jpg';
    const JOHN_RIE = 'santa_rie.jpg';
    const JOHN_CUARTO = 'santa_cuarto.jpg';
    
    // Color
    const BG_NEGRO = '#000';

    /* === HISTORIA === */
    const story = {
        // ESCENA 1
        "start": {
            img: BG_NEGRO,
            text: "\"Dicen que la Navidad es la Ã©poca mÃ¡s mÃ¡gica del aÃ±o... Risas, familia, regalos bajo el Ã¡rbol.\"",
            name: "TÃº",
            next: "intro_2"
        },
        "intro_2": {
            img: BG_NEGRO,
            text: "\"Pero para mÃ­... es solo otra noche de silencio ensordecedor.\"",
            name: "TÃº",
            next: "sala_llegada"
        },
        "sala_llegada": {
            img: SALA_LUZ,
            text: "\"LleguÃ© del trabajo arrastrando los pies. El frÃ­o se me ha metido hasta los huesos.\"",
            name: "TÃº",
            next: "sala_pensamiento"
        },
        "sala_pensamiento": {
            img: SALA_LUZ,
            text: "\"Mira este lugar... Lleno de luces y adornos. Â¿Para quÃ© me molestÃ© en decorar si vivo sola? Supongo que es la costumbre.\"",
            name: "TÃº",
            next: "sala_infancia"
        },
        "sala_infancia": {
            img: SALA_LUZ,
            text: "Haa... Es irÃ³nico... De pequeÃ±a, solÃ­a esconderme detrÃ¡s de este mismo sofÃ¡.",
            name: "TÃº",
            next: "sala_santa_fake"
        },
        "sala_santa_fake": {
            img: SALA_LUZ,
            text: "Aguantaba la respiraciÃ³n, esperando ver a Santa Claus bajar por la chimenea. Nunca lo vi. El sueÃ±o siempre me vencÃ­a antes de medianoche.",
            name: "TÃº",
            next: "sala_realidad"
        },
        "sala_realidad": {
            img: SALA_LUZ,
            text: "Cosas de niÃ±os ingenuos. Los milagros no bajan por la chimenea. En la vida real, si alguien entra en tu casa a medianoche...",
            name: "TÃº",
            next: "sala_peligro"
        },
        "sala_peligro": {
            img: SALA_LUZ,
            text: "...probablemente no venga a dejar regalos.",
            name: "TÃº",
            effect: "flash", // Parpadeo
            next: "sala_apagar"
        },
        "sala_apagar": {
            img: SALA_LUZ,
            text: "Basta de melancolÃ­a. MaÃ±ana serÃ¡ otro dÃ­a. ApagarÃ© todo y me irÃ© a la cama.",
            name: "TÃº",
            next: "sala_oscura"
        },
        "sala_oscura": {
            img: SALA_NO_LUZ,
            text: "Solo quiero dormir y olvidar que es Navidad.",
            name: "TÃº",
            next: "cuarto_ruido"
        },
        
        // EL RUIDO
        "cuarto_ruido": {
            img: CUARTO_NOCHE,
            sound: "shake",
            text: "CRASH. Â¿QuÃ©...? Â¿QuÃ© fue eso? \"JurarÃ­a que cerrÃ© la puerta con llave.\"",
            name: "TÃº",
            choices: [
                { text: "Tengo miedo (Esconderme)", target: "ruta_miedo", type: "normal" },
                { text: "Investigar (Ir a la sala)", target: "ruta_investigar", type: "premium" } // Premium visual pero gratis
            ]
        },

        // --- RUTA A: MIEDO (MUERTE) ---
        "ruta_miedo": {
            img: BG_NEGRO,
            text: "\"No... no quiero ver. Si no me muevo, quizÃ¡s se vaya.\"",
            name: "TÃº",
            next: "miedo_2"
        },
        "miedo_2": {
            img: BG_NEGRO,
            text: "\"Cierro los ojos con fuerza. Mi corazÃ³n late tan fuerte que me duele el pecho.\"",
            name: "TÃº",
            next: "miedo_3"
        },
        "miedo_3": {
            img: BG_NEGRO,
            text: "\"Escucho pasos. Pesados. Lentos. Se acercan a la cama... Se detienen justo a mi lado.\"",
            name: "TÃº",
            next: "miedo_4"
        },
        "miedo_4": {
            img: BG_NEGRO,
            text: "\"Por favor, que sea un sueÃ±o, por favor...\"",
            name: "TÃº",
            next: "miedo_voz"
        },
        "miedo_voz": {
            img: BG_NEGRO,
            sound: "shake",
            text: "Te encontrÃ©...",
            name: "Voz Desconocida",
            next: "muerte_1"
        },
        "muerte_1": {
            img: PANTALLA_MUERTE,
            text: "\"Ni siquiera me dio tiempo a gritar... SentÃ­ un estallido de dolor en la cabeza... frÃ­o... y luego nada.\"",
            name: "TÃº",
            next: "fin_malo_1"
        },
        "fin_malo_1": {
            img: BG_NEGRO,
            text: "[FINAL MALO 1: Muerte entre sÃ¡banas]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA B: INVESTIGAR (ENCUENTRO) ---
        "ruta_investigar": {
            img: SALA_NO_LUZ,
            text: "\"Me armÃ© de valor y salÃ­.\"",
            name: "TÃº",
            next: "encuentro_john"
        },
        "encuentro_john": {
            img: JOHN_SALA,
            text: "\"AllÃ­ estaba Ã©l. Un hombre alto... Â¿vestido de Santa Claus? Pero... espera.\"",
            name: "TÃº",
            next: "encuentro_reconocimiento"
        },
        "encuentro_reconocimiento": {
            img: JOHN_SALA,
            text: "\"Esa sonrisa... Esa mirada roja y frÃ­a... Mi sangre se hiela. Lo he visto en las noticias esta maÃ±ana.\"",
            name: "TÃº",
            next: "encuentro_noticias"
        },
        "encuentro_noticias": {
            img: JOHN_SALA,
            text: "\"Es Ã©l. 'El Asesino de Nochebuena'. John Red. Buscan a un psicÃ³pata que se escapÃ³ del psiquiÃ¡trico de alta seguridad.\"",
            name: "TÃº",
            next: "encuentro_panico"
        },
        "encuentro_panico": {
            img: JOHN_SALA,
            text: "\"Dijeron que era extremadamente peligroso y manipulador. Dios mÃ­o... Â¿Por quÃ© yo? Tengo que pensar rÃ¡pido.\"",
            name: "TÃº",
            next: "john_habla_1"
        },
        "john_habla_1": {
            img: JOHN_SALA,
            text: "Vaya bienvenida. Â¿Es asÃ­ como tratas a Santa cuando viene a visitarte?",
            name: "John Red",
            choices: [
                { text: "Â¡SÃ© quiÃ©n eres! (Confrontar)", target: "ruta_confrontar", type: "normal" },
                { text: "Seguirle el juego (Seducir)", target: "ruta_seducir", type: "premium" }
            ]
        },

        // --- RUTA CONFRONTAR (MUERTE) ---
        "ruta_confrontar": {
            img: JOHN_SALA,
            text: "Â¡DÃ©jate de juegos! Â¡SÃ© quiÃ©n eres! Eres John Red. Te vi en las noticias. Â¡AlÃ©jate de mÃ­, ya llamÃ© a la policÃ­a!",
            name: "TÃº",
            next: "confrontar_john"
        },
        "confrontar_john": {
            img: JOHN_SALA,
            text: "...Tsk. QuÃ© aguafiestas. Oh, asÃ­ que sabes quiÃ©n soy... QuÃ© pena.",
            name: "John Red",
            next: "confrontar_asesino"
        },
        "confrontar_asesino": {
            img: JOHN_ASESINO,
            text: "Odio cuando arruinan la inmersiÃ³n del personaje. Supongo que esto serÃ¡ mÃ¡s rÃ¡pido de lo que pensÃ©.",
            name: "John Red",
            next: "huida_puerta"
        },
        "huida_puerta": {
            img: PUERTA_SALIR,
            text: "Â¡Espera, no-! \"Debo salir rÃ¡pido...\"",
            name: "TÃº",
            next: "muerte_2"
        },
        "muerte_2": {
            img: PANTALLA_MUERTE,
            sound: "shake",
            text: "\"Es inhumano... Se moviÃ³ mÃ¡s rÃ¡pido que mi propia sombra. El cuchillo... quema...\"",
            name: "TÃº",
            next: "fin_malo_2"
        },
        "fin_malo_2": {
            img: BG_NEGRO,
            text: "[FINAL MALO 2: Enfrentarlo no es una OpciÃ³n]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA SEDUCIR ---
        "ruta_seducir": {
            img: JOHN_SALA,
            text: "\"Tranquila... Respira. Si corro, me caza como a un animal. Tengo que jugar su juego. Voy a apostarlo todo a una carta: su ego.\"",
            name: "TÃº",
            next: "seducir_dialogo"
        },
        "seducir_dialogo": {
            img: JOHN_SALA,
            text: "Vaya... No sabÃ­a que Santa Claus serÃ­a tan joven... y tan atractivo. Si lo hubiera sabido, te habrÃ­a dejado la chimenea encendida.",
            name: "TÃº",
            next: "john_rie"
        },
        "john_rie": {
            img: JOHN_RIE,
            text: "Jajaja... Interesante. Muy interesante.",
            name: "John Red",
            next: "john_interes"
        },
        "john_interes": {
            img: JOHN_RIE,
            text: "Normalmente la gente grita o corre cuando me ve. Pero tÃº... TÃº pareces querer abrir tus regalos antes de tiempo.",
            name: "John Red",
            next: "decision_chica"
        },
        "decision_chica": {
            img: JOHN_RIE,
            text: "Dime... Â¿Has sido una chica mala este aÃ±o?",
            name: "John Red",
            choices: [
                { text: "He sido una buena chica...", target: "ruta_buena", type: "normal" },
                { text: "Quiero hacer cosas malas...", target: "ruta_mala", type: "premium" }
            ]
        },

        // --- RUTA CHICA BUENA (MUERTE) ---
        "ruta_buena": {
            img: JOHN_RIE,
            text: "\"Intento sonreÃ­r dulcemente, esperando que la inocencia me salve.\"",
            name: "TÃº",
            next: "buena_dialogo"
        },
        "buena_dialogo": {
            img: JOHN_RIE,
            text: "He sido una buena chica todo el aÃ±o. Merezco algo bueno, Â¿verdad?",
            name: "TÃº",
            next: "john_buena"
        },
        "john_buena": {
            img: JOHN_RIE,
            text: "Â¿Ah, sÃ­? Mmm... Las chicas buenas merecen recompensas especiales. Anda, cierra los ojos y extiende las manos. No hagas trampa.",
            name: "John Red",
            next: "buena_ojos"
        },
        "buena_ojos": {
            img: BG_NEGRO,
            text: "\"Gracias a Dios... funcionÃ³. Solo quiere dejarme un regalo y irse. Cierro los ojos, sintiendo un leve alivio.\"",
            name: "TÃº",
            next: "buena_espera"
        },
        "buena_espera": {
            img: BG_NEGRO,
            text: "\"Espero... ...\"",
            name: "TÃº",
            sound: "shake",
            next: "muerte_3"
        },
        "muerte_3": {
            img: PANTALLA_MUERTE,
            text: "Â¡Ah...! Â¿Por... quÃ©...? \"El dolor es agudo en mi pecho. No puedo respirar.\"",
            name: "TÃº",
            next: "john_regalo_final"
        },
        "john_regalo_final": {
            img: PANTALLA_MUERTE,
            text: "Â¿Te gusta mi regalo? VerÃ¡s, preciosa... para un artista como yo, no hay regalo mÃ¡s hermoso que quitar una vida. Feliz Navidad.",
            name: "John Red",
            next: "fin_malo_3"
        },
        "fin_malo_3": {
            img: BG_NEGRO,
            text: "[FINAL MALO 3: Regalo Equivocado]",
            name: "GAME OVER",
            restart: true
        },

        // --- RUTA CHICA MALA (FINAL DEMO) ---
        "ruta_mala": {
            img: JOHN_RIE,
            text: "\"Lo miro directo a los ojos, desafiante. Si voy a morir, serÃ¡ jugando bajo mis propias reglas.\"",
            name: "TÃº",
            next: "mala_accion"
        },
        "mala_accion": {
            img: JOHN_RIE,
            text: "He sido una buena chica... \"Doy un paso mÃ¡s hacia Ã©l, invadiendo su espacio personal.\"",
            name: "TÃº",
            next: "mala_deseo"
        },
        "mala_deseo": {
            img: JOHN_RIE,
            text: "...pero esta noche quiero hacer cosas malas.",
            name: "TÃº",
            next: "john_sorpresa"
        },
        "john_sorpresa": {
            img: JOHN_RIE,
            text: "Jaja... Vaya. Eso no me lo esperaba.",
            name: "John Red",
            next: "mala_tactil"
        },
        "mala_tactil": {
            img: JOHN_SALA,
            text: "\"Pongo una mano sobre su pecho, justo sobre el borde de su traje de Santa.\" Ya que estÃ¡s aquÃ­... Â¿Puedo pedir al Santa como regalo esta noche?",
            name: "TÃº",
            next: "john_agarre"
        },
        "john_agarre": {
            img: JOHN_RIE, // O una donde se vea mÃ¡s cerca si la tienes
            text: "\"John Red suelta una risa ronca y me agarra de la cintura con fuerza, atrayÃ©ndome hacia Ã©l.\"",
            name: "NarraciÃ³n",
            next: "john_advertencia"
        },
        "john_advertencia": {
            img: JOHN_SALA, // Se mantiene la tensiÃ³n
            text: "Cuidado con lo que deseas... Santa no acepta devoluciones.",
            name: "John Red",
            next: "cuarto_final"
        },
        "cuarto_final": {
            img: JOHN_CUARTO,
            text: "\"Ni siquiera sÃ© cÃ³mo lleguÃ©, pero ahora estoy aquÃ­ en mi cuarto, y Ã©l me mira desde arriba con esa intensidad depredadora.\"",
            name: "TÃº",
            next: "john_valiente"
        },
        "john_valiente": {
            img: JOHN_CUARTO,
            text: "Bien... Vamos a ver si eres tan valiente como pareces.",
            name: "John Red",
            next: "john_olvido"
        },
        "john_olvido": {
            img: JOHN_CUARTO,
            text: "OlvÃ­date de la Navidad. Esta noche solo existimos tÃº y yo.",
            name: "John Red",
            next: "fin_demo"
        },
        "fin_demo": {
            img: BG_NEGRO,
            text: "FIN DE LA DEMO (PRUEBA DE FLUJO)",
            name: "Sistema",
            restart: true
        }
    };

    /* MOTOR DEL JUEGO */
    const sceneBack = document.getElementById("scene-layer-back");
    const sceneFront = document.getElementById("scene-layer-front");
    const textName = document.getElementById("char-name");
    const textDialog = document.getElementById("dialogue-text");
    const nextBtn = document.getElementById("next-btn");
    const choicesArea = document.getElementById("choices-area");
    const effectLayer = document.getElementById("effect-layer");

    // FunciÃ³n para poner imagen
    function setLayerImage(layer, imgSource) {
        if (imgSource.startsWith("#")) {
            layer.style.backgroundImage = "none";
            layer.style.backgroundColor = imgSource;
        } else {
            layer.style.backgroundColor = "#000";
            layer.style.backgroundImage = `url('${imgSource}')`;
        }
    }

    function renderNode(nodeId) {
        const node = story[nodeId];
        nextBtn.classList.remove("hidden");
        choicesArea.classList.add("hidden");
        choicesArea.innerHTML = "";
        effectLayer.className = ""; 

        // 1. FUSIÃ“N DE IMÃGENES
        if (node.img) {
            setLayerImage(sceneFront, node.img);
            setTimeout(() => { sceneFront.classList.add("fade-in"); }, 50);
            setTimeout(() => {
                setLayerImage(sceneBack, node.img);
                sceneFront.classList.remove("fade-in");
            }, 850);
        }

        // 2. TEXTO
        textName.textContent = node.name || "";
        textDialog.textContent = node.text || "...";

        // 3. EFECTOS ESPECIALES
        if (node.sound === "shake") {
            document.body.classList.add("shake");
            setTimeout(() => document.body.classList.remove("shake"), 500);
        }
        if (node.effect === "flash") {
            effectLayer.classList.add("red-flash"); // Un flash sutil oscuro
            setTimeout(() => effectLayer.classList.remove("red-flash"), 200);
        }

        // 4. OPCIONES VS SIGUIENTE
        if (node.choices) {
            nextBtn.classList.add("hidden");
            choicesArea.classList.remove("hidden");
            node.choices.forEach(choice => {
                const btn = document.createElement("button");
                // Usamos el estilo visual premium, pero sin lÃ³gica de anuncio
                btn.className = choice.type === "premium" ? "btn btn-premium" : "btn btn-normal";
                btn.textContent = choice.text;
                btn.onclick = () => renderNode(choice.target);
                choicesArea.appendChild(btn);
            });
        } else if (node.restart) {
            nextBtn.onclick = () => location.reload();
            nextBtn.textContent = "â†» Reiniciar";
        } else {
            nextBtn.onclick = () => renderNode(node.next);
            nextBtn.textContent = "â–¼";
        }
    }

    // Arrancar
    window.onload = () => { 
        setLayerImage(sceneBack, story["start"].img);
        renderNode("start"); 
    };
</script>
</body>
</html>
